<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:s="http://jboss.com/products/seam/taglib"
	xmlns:a="http://richfaces.org/a4j" xmlns:r="http://richfaces.org/rich"
	template="layout/template.xhtml">

	<ui:define name="body">

		<h:form id="journalSearch">
		<r:panel id="searchCriteria">
		<f:facet name="header">Search Journals</f:facet>
			<h:panelGrid columns="2">
				<h:outputLabel for="searchByIssn" styleClass="outLabel"
									value="by ISSN" />
				<h:inputText id="searchByIssn" value="#{journalSearch.issn}"
					style="width: 100px;" title="enter 9 digit ISSN (i.e.: 1234-5678) allowed wildcards are ? or *, BUT NOT as the first character!!!" />
				<h:outputLabel for="searchByTitle" styleClass="outLabel"
									value="OR by Title" />
				<h:inputText id="searchByTitle" value="#{journalSearch.title}"
					style="width: 200px;" title="use quotes, if there is white space, + sign to search for specific words. allowed wildcards OUTSIDE QUOTES and NOT as first characters are ? and *"/>
					<h:outputLabel for="titleSuggestions" value="" />
					<r:suggestionbox id="titleSuggestions" for="searchByTitle" suggestionAction="#{journalSearch.completeTitleSuggestions}"
					var="selectedTitle" fetchValue="#{selectedTitle}" minChars="1" width="150" height="100" border="1">
					<h:column>
					<h:outputText value="#{selectedTitle}"/>
					</h:column>
					</r:suggestionbox>
				<h:outputLabel for="rightsList" styleClass="outLabel"
									value="AND by Rights" />
				<h:selectOneListbox id="rightsList" size="1" style="width:100px" valueChangeListener="#{journalSearch.changedRights}" onChange="this.form.submit()">
				<f:selectItems id="rightsItems" value="#{journalSearch.rightsItems}" />
				</h:selectOneListbox>
				<h:outputLabel for="searchBySubject" styleClass="outLabel"
									value="AND by Subject" />
				<h:inputText id="searchBySubject" value="#{journalSearch.subject}"
					style="width: 200px;" title="use quotes, if there is white space, + sign to search for specific words. allowed wildcards OUTSIDE QUOTES and NOT as first characters are ? and *"/>
					<r:suggestionbox id="subjectSuggestions" for="searchBySubject" suggestionAction="#{journalSearch.completeSubjectSuggestions}"
					var="selectedSubject" fetchValue="#{selectedSubject}" minChars="1" width="150" height="100" border="1">
					<h:column>
					<h:outputText value="#{selectedSubject}"/>
					</h:column>
					</r:suggestionbox>
				<a:commandButton id="findJournals" value="#{jnar.searchButtonValue}"
					action="#{journalSearch.findJournals}" reRender="searchResultsPanel">
					<a:ajaxListener type="org.ajax4jsf.ajax.ForceRender" />
				</a:commandButton>
			</h:panelGrid>
			</r:panel>
		</h:form>
		<r:messages id="cone_messages" layout="list" showDetail="true" showSummary="false"/>
		<h:form id="journalResults">
		<r:panel id="searchResultsPanel">
			<h:panelGrid id="searchResults">
				<r:datascroller id="scroller" align="left" for="journals"
					maxPages="20" boundaryControls="auto"
					rendered="#{journalSearch.journalTable.rowCount > journalSearch.journalTable.rows}" />

				<r:spacer height="10" />
				<h:dataTable binding="#{journalSearch.journalTable}" id="journals"
					value="#{journalSearch.journalList}" var="jour" rows="10">
					<h:column binding="#{journalSearch.journalIssnColumn}"
						id="journalIssnColumn" width="20%" rendered="false">
						<h:outputText id="journalTitle" value="#{jour[0]}"/>
					</h:column>
					<h:column binding="#{journalSearch.journalTitleColumn}"
						id="journalTitleColumn" width="80%">
						<a:commandLink id="lnkDetails" immediate="true" value="#{jour[1]}"
							action="#{journalSearch.getDetails}" styleClass=""
							reRender="searchResults">
							<a:ajaxListener type="org.ajax4jsf.ajax.ForceRender" />
						</a:commandLink>
							<h:panelGrid binding="#{journalSearch.journalDetails}"
								id="details" columns="2" rowClasses="gridRow1, gridRow2"
								rendered="#{journalSearch.selectedRowId == journalSearch.journalTable.rowIndex}">
								<h:outputLabel for="alttitle" styleClass="outLabel"
									value="Alternative Title(s) " style="vertical-align:top"/>
								<h:dataTable id="alttitle" value="#{journalSearch.jnar.altTitles}" var="alt" >
								<h:column>
								<h:outputText value="#{alt}" styleClass="outText" />
								</h:column>
								</h:dataTable>
								<h:outputLabel for="identifier" styleClass="outLabel"
									value="ISSN " />
								<h:outputText id="identifier" styleClass="outText"
									value="#{journalSearch.jnar.identifier}" />
								<h:outputLabel for="subject" styleClass="outLabel"
									value="Subject " />
								<h:outputText id="subject" styleClass="outText"
									value="#{journalSearch.jnar.subject}" />
								<h:outputLabel for="publisher" styleClass="outLabel"
									value="Publisher " />
								<h:outputText id="publisher" styleClass="outText"
									value="#{journalSearch.jnar.publisher}" />
								<h:outputLabel for="rights" styleClass="outLabel"
									value="Rights " />
								<h:outputText id="rights" styleClass="outText"
									value="#{journalSearch.jnar.rights}" />
								<h:outputLabel for="lnkJournalEdit" styleClass="outLabel"
									value="Modify ? " rendered="#{identity.loggedIn}"/>
								<a:commandLink id="lnkJournalEdit" immediate="true" value="edit"
									action="loadJournalEdit" actionListener="#{journalEdit.action}" rendered="#{identity.loggedIn}">
									<f:setPropertyActionListener target="#{journalEdit.jnar2edit}" value="#{journalSearch.jnar}"/>
									<f:setPropertyActionListener target="#{journalEdit.issn2edit}" value="#{journalSearch.jnar.identifier}"/>
									<f:setPropertyActionListener target="#{journalEdit.title2edit}" value="#{journalSearch.jnar.title}"/>
									<f:setPropertyActionListener target="#{journalEdit.publisher2edit}" value="#{journalSearch.jnar.publisher}"/>
									<f:setPropertyActionListener target="#{journalEdit.subject2edit}" value="#{journalSearch.jnar.subject}"/>
									<f:setPropertyActionListener target="#{journalEdit.rights2edit}" value="#{journalSearch.jnar.rights}"/>
									<f:setPropertyActionListener target="#{journalEdit.altTitles2edit}" value="#{journalSearch.jnar.altTitles}"/>
								</a:commandLink>
							</h:panelGrid>
						
					</h:column>
				</h:dataTable>
			</h:panelGrid>
		</r:panel>
				<r:toolBar>
					<r:toolBarGroup>
						<h:outputText value="GO" />
						<h:commandLink id="footHome" immediate="true" value="HOME"
							action="#{navigation.loadJournalNames}" styleClass="" />
						<h:commandLink id="footBack" immediate="true" value="ADD"
							action="#{navigation.loadJournalAdd}" styleClass="" rendered="#{identity.loggedIn}"/>
					</r:toolBarGroup>
				</r:toolBar>			
		</h:form>

	</ui:define>

</ui:composition>
